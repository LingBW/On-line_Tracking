<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>DRIFT TRACK: Specify Track</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="http://maps.googleapis.com/maps/api/js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="track.css" />
</head>

<body>
<script type='text/javascript'>
var map;
//var lat = new Array();
//var lon = new Array();
var blon = [-70.56523132,-70.55568695,-70.54127502,-70.51769257,-70.4887085,-70.45444489, -70.41751099,-70.37443542,-70.32566833,-70.27555847,-70.22293091,
-70.17166138,-70.12519073,-70.08081818,-70.03473663,-69.99349976,-69.95652771,-69.92127228,-69.88608551,-69.85466766,-69.82696533,-69.80090332,
-69.77420807,-69.75162506,-69.72977448,-69.70681,-69.68741608,-69.66733551,-69.64723206,-69.62756348,-69.6092453,-69.59226227,-69.57754517,
-69.56684113,-69.55465698,-69.54200745,-69.52998352,-69.51828766,-69.5072937,-69.49562836,-69.4863205,-69.4780426,-69.46891022,-69.46052551,
-69.45361328,-69.44780731,-69.43980408,-69.43190765,-69.42590332,-69.42029572,-69.41673279,-69.41648865,-69.41824341,-69.42116547,-69.43023682,
-69.45327759,-69.47947693,-69.51366425,-69.55973053,-69.61219788,-69.66555786,-69.71883392,-69.7742157,-69.83042145,-69.88809967,-69.94330597,
-69.99676514,-70.04312897,-70.08609009,-70.13182068,-70.17913818,-70.22502899,-70.26779175,-70.30864716,-70.34566498,-70.38423157,-70.42088318,
-70.45910645,-70.50008392,-70.54241943,-70.5864563,-70.62549591,-70.66362,-70.70063019,-70.73816681,-70.7766571,-70.81590271,-70.85388184,
-70.89139557,-70.92655182,-70.96057892,-70.99299622,-71.01782227,-71.03871918,-71.05687714,-71.07309723,-71.087883,-71.10095215,-71.11279297,
-71.12397003,-71.13362885,-71.14287567,-71.14985657,-71.15574646,-71.1598587,-71.16300201,-71.16574097,-71.16799927,-71.17006683,-71.17184448,
-71.17356873,-71.17495728,-71.17643738,-71.17751312,-71.17874146,-71.17991638,-71.18083191,-71.18190002,-71.18319702,-71.18414307,-71.18495178,
-71.18585205,-71.1869278,-71.18739319];//124

var blat = [43.29334641,43.29613495,43.2916832,43.28342056,43.27177811,43.25782394,43.24125671,43.22229004,43.20048141,43.17580032,43.14955139,43.12094116,
43.09122849,43.058918,43.02238846,42.98452377,42.94473648,42.90424728,42.8596344,42.81295395,42.76594543,42.71746063,42.66558075,42.61373901,
42.56036377,42.50841904,42.45609283,42.40775299,42.35661697,42.30488205,42.25428772,42.20787048,42.16667938,42.13007355,42.09297562,42.05569458,
42.01745224,41.97663498,41.93488693,41.88988876,41.84719086,41.80692291,41.76527023,41.72560501,41.68729782,41.64827347,41.60509491,41.55762482,
41.50980377,41.45916367,41.40763855,41.35613251,41.30070496,41.24675751,41.19999313,41.14581299,41.10514832,41.07080078,41.04304886,41.02209091,
41.00462723,40.98908615,40.97613907,40.96683502,40.96137238,40.95975494,40.95906448,40.95782471,40.95705032,40.95771408,40.95699692,40.95644379,
40.95566177,40.95547104,40.95511627,40.95460129,40.95449066,40.95533752,40.9560051,40.95743561,40.95818329,40.95821762,40.95733643,40.95660019,
40.95660019,40.95697403,40.9575119,40.95861053,40.96048355,40.96316528,40.96753311,40.9793396,40.99704742,41.01681519,41.03744507,41.05929947,
41.08055878,41.10149002,41.12216568,41.14284134,41.16221237,41.18068314,41.19836044,41.21506119,41.23172379,41.24686813,41.26092148,41.27466202,
41.28905869,41.30297852,41.31729889,41.33091354,41.34298325,41.35480881,41.36629868,41.3772049,41.38829041,41.39926529,41.40955734,41.41902161,
41.42766953,41.43568802,41.44309998,41.44961929];

var blongom = [-59.8422966,-59.79644775,-59.75998688,-59.6895256,-59.61975098,-59.5463295,-59.46944046,-59.39248276,-59.31188202,
-59.22563171,-59.12981796,-59.02770233,-58.93340302,-58.83458328,-58.72618484,-58.60999298,-58.49430847,-58.37178421,-58.25960541,
-58.16139603,-58.06389236,-57.97196198,-57.88108826,-57.77483749,-57.67421722,-57.57252884,-57.47542953,-57.38441086,-57.30058289,
-57.22280884,-57.14546204,-57.06642532,-56.99157333,-56.94517136,-56.93769455,-56.96884537,-57.05113983,-57.28504562,-57.56803131,
-57.88903809,-58.22618484,-58.55018616,-58.88199615,-59.24614334,-59.61563492,-59.98696518,-60.36632156,-60.73336029,-61.09703445,
-61.47330475,-61.86230087,-62.2557869,-62.61442947,-62.9874649,-63.35930634,-63.73993683,-64.09302521,-64.46059418,-64.82348633,
-65.19263458,-65.55136871,-65.91236115,-66.2718811,-66.62508392,-66.9702301,-67.32670593,-67.68323517,-68.02801514,-68.37217712,
-68.72569275,-69.0639801,-69.40656281,-69.73342896,-70.0329361,-70.35739899,-70.69316101,-71.01316071,-71.30558014,-71.60992432,
-71.93365479,-72.26808929,-72.62046051,-72.99863434,-73.35575104,-73.67067719,-73.96638489,-74.24528503,-74.49217987,-74.72927856,
-74.94276428,-75.12520599,-75.3081665,-75.46529388,-75.58956909,-75.60964966];//95

var blatgom = [46.09955978,46.09812546,46.06233215,45.98487091,45.91524124,45.8367691,45.7572403,45.67584991,45.59239197,45.50065231,45.39779663,
45.28820038,45.17479324,45.05860519,44.93920898,44.81700134,44.68763351,44.56115341,44.45036697,44.34666443,44.24715042,44.13467026,
44.01534271,43.89720917,43.77528,43.66847229,43.5580864,43.44954681,43.34078979,43.22609329,43.0898819,42.93606186,42.76111221,
42.56398392,42.3558197,42.14693832,42.00566101,41.83415604,41.69781876,41.56034088,41.41804504,41.28196716,41.13793564,40.99334717,
40.84661102,40.71167374,40.56488419,40.41525269,40.26342392,40.09697723,39.927948,39.77371979,39.63469315,39.49209213,39.34996033,
39.19626999,39.05273056,38.9165802,38.78321075,38.64503098,38.49833298,38.35327148,38.21601486,38.07172775,37.92402267,37.78035736,
37.63948441,37.49339676,37.34867096,37.19553375,37.03907776,36.87566757,36.72651672,36.58995438,36.44178009,36.28126144,36.12561798,
35.97452545,35.81864929,35.66109848,35.51485062,35.40787125,35.37496567,35.42101669,35.56871414,35.76475525,35.99146652,36.22259903,
36.46731949,36.68853378,36.86878586,37.03686523,37.17869949,37.28518677,37.34851456];

var romsblon = [-79.588634505,-71.4296023443,-67.7072694191,-75.8382859933,-79.588634505];
var romsblat = [36.9526726622,42.8688216618,39.8945867263,33.7446052907,36.9526726622];

var markers = [];
function initialize() {
	//document.form1.alat.value = null;
	//document.form1.alon.value = null;
	if (document.form1.dset.value == "massbay") {	
		var myCenter=new google.maps.LatLng(42.1253128052,-70.301940918);
		var mapProp = {center:myCenter,zoom:8,mapTypeId:google.maps.MapTypeId.SATELLITE}
		map = new google.maps.Map(document.getElementById("googleMap"),mapProp);
		var bps = new Array;
		for (var i=0; i<blon.length; i++) {
			bps[i] = new google.maps.LatLng(blat[i],blon[i]);
		}
		var flightPath=new google.maps.Polyline({
			path:bps,
			strokeColor:"yellow",
			strokeOpacity:0.8,
			strokeWeight:2
		});
	}                

	if (document.form1.dset.value == "GOM3" || document.form1.dset.value == "30yr") {
		var myCenter=new google.maps.LatLng(42.1253128052,-70.301940918);
		var mapProp = {center:myCenter,zoom:5, mapTypeId:google.maps.MapTypeId.SATELLITE, elementType: "labels"}
		map = new google.maps.Map(document.getElementById("googleMap"),mapProp);
		var bps = new Array;
		for (var i=0; i<blongom.length; i++) {
			bps[i] = new google.maps.LatLng(blatgom[i],blongom[i]);
		}
		var flightPath=new google.maps.Polyline({
			path:bps,
			strokeColor:"yellow",
			strokeOpacity:0.8,
			strokeWeight:2
		});
	}
	
	if (document.form1.dset.value == "ROMS") {	
		var myCenter=new google.maps.LatLng(38.30671347625,-73.64795196205);
		var mapProp = {center:myCenter,zoom:6,mapTypeId:google.maps.MapTypeId.SATELLITE}
		map = new google.maps.Map(document.getElementById("googleMap"),mapProp);
		var bps = new Array;
		for (var i=0; i<romsblon.length; i++) {
			bps[i] = new google.maps.LatLng(romsblat[i],romsblon[i]);
		}
		var flightPath=new google.maps.Polyline({
			path:bps,
			strokeColor:"yellow",
			strokeOpacity:0.8,
			strokeWeight:2
		});
	}
	flightPath.setMap(map);
	
	google.maps.event.addListener(map, 'click', function(event){placeMarker(event.latLng);});
}        
   
function placeMarker(location) {
	var znum;
	if (document.form1.dset.value == "massbay") {
		var boundaryCoords = [
		    new google.maps.LatLng(43.300,-70.570),
		    new google.maps.LatLng(43.121,-70.169),
		    new google.maps.LatLng(42.767,-69.815),
		    new google.maps.LatLng(41.943,-69.499),
		    new google.maps.LatLng(41.224,-69.397),
		    new google.maps.LatLng(41.050,-69.501),
		    new google.maps.LatLng(40.957,-69.827),
		    new google.maps.LatLng(40.961,-70.987),
		    new google.maps.LatLng(41.550,-71.199),
		    new google.maps.LatLng(41.841,-70.632),
		    new google.maps.LatLng(42.387,-71.198),
		    new google.maps.LatLng(42.622,-70.821),
		    new google.maps.LatLng(42.943,-70.842)];
		znum = 10
	}
	if (document.form1.dset.value == "GOM3" || document.form1.dset.value == "30yr") {
		var boundaryCoords = [
			new google.maps.LatLng(46.120,-59.814),
		    new google.maps.LatLng(42.976,-56.961),
		    new google.maps.LatLng(41.967,-56.906),
		    new google.maps.LatLng(35.281,-72.639),
		    new google.maps.LatLng(35.558,-73.864),
		    new google.maps.LatLng(37.422,-75.755),
		    new google.maps.LatLng(40.871,-74.965),
		    new google.maps.LatLng(45.365,-67.137)];
		znum = 7
	}
	if (document.form1.dset.value == "ROMS") {
		var boundaryCoords = [
			new google.maps.LatLng(36.9526726622,-79.588634505),
		    new google.maps.LatLng(42.8688216618,-71.4296023443),
		    new google.maps.LatLng(39.8945867263,-67.7072694191),
		    new google.maps.LatLng(33.7446052907,-75.8382859933)];
		znum = 8
	}
	var modelboundary = new google.maps.Polygon({
	    paths: boundaryCoords
		});
	var result;
	var tne;
    if (google.maps.geometry.poly.containsLocation(location, modelboundary)) {
	    result = 'startmarker.png';
	    tne = 'Start point';
	    var infowindow = new google.maps.InfoWindow({
	    	content: 'Latitude: ' + parseFloat(location.lat()).toFixed(6) + '<br>Longitude: ' + parseFloat(location.lng()).toFixed(6)});
    	document.form1.alon.value=parseFloat(location.lng()).toFixed(3);
		document.form1.alat.value=parseFloat(location.lat()).toFixed(3);
		deleteMarkers();
		var marker = new google.maps.Marker({position: location, icon:result, title: tne});//map: map,
    } 
    else {
     	result = 'endmarker.png';
     	tne = 'Invalid point'
     	var infowindow = new google.maps.InfoWindow({
      		content: 'Latitude: ' + parseFloat(location.lat()).toFixed(6) + '<br>Longitude: ' + parseFloat(location.lng()).toFixed(6)+'<br><strong>Note:</strong> Point out of Model Zone'});
    	deleteMarkers();
		var marker = new google.maps.Marker({position: location, icon:result, title: tne});//map: map,
		marker.setAnimation(google.maps.Animation.BOUNCE);
    }
 
	marker.setMap(map);
	markers.push(marker);
	// Zoom to 10 when clicking on marker
	google.maps.event.addListener(marker,'click',function() {map.setZoom(znum);map.setCenter(marker.getPosition());infowindow.open(map,marker);});  	 
}

// Sets the map on all markers in the array.
function setAllMap(map) {
  for (var i = 0; i < markers.length; i++) {
    markers[i].setMap(map);
  }
}

// Removes the markers from the map, but keeps them in the array.
function clearMarkers() {
  setAllMap(null);
}

// Shows any markers currently in the array.
function showMarkers() {
  setAllMap(map);
}

// Deletes all markers in the array by removing references to them.
function deleteMarkers() {
  clearMarkers();
  markers = [];
}

function setAnim() {
	for (var i = 0; i < markers.length; i++) {
	    markers[i].setMap(map);
		//markers[i].setAnimation(google.maps.Animation.BOUNCE);
		map.setZoom(7);
		map.setCenter(markers[i].getPosition());
	}
}
google.maps.event.addDomListener(window, 'load', initialize); 

function funreset() {
    lon = document.form1.alon.value = null;
	document.form1.alat.value = null;
	document.form1.dset.value = "GOM3";
	initialize();
}

function showpoint() {
	// show point on the map when click button 'Show on Map'
	var lon = document.form1.alon.value;
	var lat = document.form1.alat.value;
	if (lon && lat) {
		deleteMarkers();
		var spoint = new google.maps.LatLng(lat,lon);
		placeMarker(spoint);
		setAnim();	        	
	}
}

function checkpoint() {
	var lon = document.form1.alon.value;
	var lat = document.form1.alat.value;
	var spoint = new google.maps.LatLng(lat,lon)
	if (lat && lon) {
		if (document.form1.dset.value == "massbay") {
			var boundaryCoords = [
			    new google.maps.LatLng(43.300,-70.570),
			    new google.maps.LatLng(43.121,-70.169),
			    new google.maps.LatLng(42.767,-69.815),
			    new google.maps.LatLng(41.943,-69.499),
			    new google.maps.LatLng(41.224,-69.397),
			    new google.maps.LatLng(41.050,-69.501),
			    new google.maps.LatLng(40.957,-69.827),
			    new google.maps.LatLng(40.961,-70.987),
			    new google.maps.LatLng(41.550,-71.199),
			    new google.maps.LatLng(41.841,-70.632),
			    new google.maps.LatLng(42.387,-71.198),
			    new google.maps.LatLng(42.622,-70.821),
			    new google.maps.LatLng(42.943,-70.842)];
		}
		if (document.form1.dset.value == "GOM3" || document.form1.dset.value == "30yr") {
			var boundaryCoords = [
				new google.maps.LatLng(46.120,-59.814),
			    new google.maps.LatLng(42.976,-56.961),
			    new google.maps.LatLng(41.967,-56.906),
			    new google.maps.LatLng(35.281,-72.639),
			    new google.maps.LatLng(35.558,-73.864),
			    new google.maps.LatLng(37.422,-75.755),
			    new google.maps.LatLng(40.871,-74.965),
			    new google.maps.LatLng(45.365,-67.137)];
		}
		if (document.form1.dset.value == "ROMS") {
			var boundaryCoords = [
				new google.maps.LatLng(36.9526726622,-79.588634505),
			    new google.maps.LatLng(42.8688216618,-71.4296023443),
			    new google.maps.LatLng(39.8945867263,-67.7072694191),
			    new google.maps.LatLng(33.7446052907,-75.8382859933)];
		}
		var modelboundary = new google.maps.Polygon({
		    paths: boundaryCoords
			});
		
		if (!google.maps.geometry.poly.containsLocation(spoint, modelboundary)) {
			throw "This point is out of Model Zone."
		}
	}
}
</script>
	
<script type='text/javascript'>
function checksubmit() {
	//check start point
	
	var lon = document.form1.alon.value;
	var lat = document.form1.alat.value;
	if (!lon || !lat) {
		window.alert("You didn't finish enter a point.");
		return false	
	}
	
	else {
		try {
			checkpoint()
		}
		catch (er) {
			window.alert(er);
			return false
		}
	}	
	//check track days
	var tds = document.form1.tds.value
	if (isNaN(tds) || tds.length==0) {
		window.alert("Number of days to track: Error! Please enter a number.")
		return false
	}
	if (document.form1.dset.value == "GOM3" || document.form1.dset.value == "massbay") {
		if (tds<-6 || tds>6) {
			window.alert("Number of days to track: Error! This model only works in last and after 3 days from now.")
			return false
		}
	}
	//check start time
	var stt = document.form1.stt.value
	if (stt) {
		//The parseFloat() function parses a string and returns a floating point number
		if (!parseFloat(stt)) {
			window.alert("Start time: Format Error! ")
			return false
		}
	}
	//check depth
	var depth = document.form1.depth.value
	if (isNaN(depth) || depth<0) {
		window.alert("Depth: Value Error! Please enter a positive number.")
		return false
	}
}

function checklat() {
	var lat = document.form1.alat.value;
	//if (isNaN(lat) || (!lat)) {}
	
	if (lat>3344.676 && lat<4605.976) {
		turnlat();
		//showpoint();
		}
	else if (lat>33.7446 && lat<46.0996){
		//showpoint()
		
		}
	else {
		window.alert("Latitude error!　Out of Model Zone or Format error.")
		document.form1.alat.value = null;
	}
}
function checklon(){
	var lon = document.form1.alon.value;
	if (lon>5656.262 && lon<7935.316) {
		turnlon();
		//showpoint();
		}
	else if (lon<-5656.262 && lon>-7935.316) {
		turnlon();
	}
	else if (lon<-56.9377 && lon>-79.5886) {
		//showpoint();
		
		}
	else {
		window.alert("Longitude error! Out of Model Zone or Format error.")
		document.form1.alon.value = null;
		}
}

function settime() {
	//setting current time to 'start time'
	var seti = new Date();
	//var det = seti.toLocaleString();
	var det = (seti.getMonth()+1)+"/"+seti.getDate()+"/"+seti.getFullYear()+", "+seti.getHours()+":"+seti.getMinutes();
	document.form1.stt.value = det;
}

function onch() {
	//checklat();
	//checklon();
	initialize();
}

function turnlat() {
	var val = document.form1.alat.value;
	var vat = val.toString();
	var la = vat.slice(2,-1);
	var lm1 = Number(la)
	if (lm1>=60.0) {
		window.alert("Latitude format error!");
		document.form1.alat.value = null;
	}
	
	else {
		var fo = vat.slice(0,2)
		var lal = Number(fo) + Number(la/60)
		document.form1.alat.value = lal;
	}
}

function turnlon() {
	var valp = document.form1.alon.value;	
	if (Number(valp)>0) {
		var valp = valp*(-1)
	}
	var vato = valp.toString();
	var lao = vato.slice(3,-1);
	var lm = Number(lao);
	if (lm>=60.0) {
		window.alert("Longitude format error!");
		document.form1.alon.value = null;
	}	
	//window.alert(lm);
	else {
		var foo = vato.slice(0,3);
		var lalo = Number(foo) - Number(lao/60);
		//var lalon = "-"+lalo.toString()
		document.form1.alon.value = lalo;
		//checklat();
	}
	
}

function showp() {
	var lon = document.form1.alon.value;
	var lat = document.form1.alat.value;
	if (!lon || !lat) {
		window.alert("You didn't finish enter a point.");
		//return false	
		}	
	else {
		checklat();
		checklon();
		showpoint();
		}
}
</script>
	
<div id="header">
<h2>User specifies lat/lon start points in decimal degrees or DDMM.MM</h2>
</div>

<script type="text/javascript" >
function myFunction() {
	var xa=document.getElementById("section").innerHTML;
	document.getElementById("section1").innerHTML=xa;	
}
</script>

<div id="container">
	<div id="navibar">
		Start Options:
		<ul id="naviul">
			<li><a href="http://comet.nefsc.noaa.gov/ioos/track/index.html" >Click on map</a></li>
			<li><a href="http://comet.nefsc.noaa.gov/ioos/track/index1.html" >Specify lat/lon</a></li>
			<li><a href="http://comet.nefsc.noaa.gov/ioos/track/index2.html" >Use drifter fix</a></li>
			<li id="hli"><a href="http://comet.nefsc.noaa.gov/ioos/track/help.html" >Help</a></li>
		</ul>
	</div>

	<!div id="section">
	<div id="googleMap" ></div>

	<div id="optionbar">
		<h4>Specify Track</h4>
		<form action='/cgi-bin/ioos/track/specify-track-CGI.py' method='POST' name='form1' onsubmit='return checksubmit()'> 			        		        
			<ol class="ul">
				<li>Latitude:<input type='text' name='alat' size='8' value='' onblur='' maxlength="10"><br />
				   Longitude:<input type='text' name='alon' size='8' value='' onblur='' maxlength="10"></li>
				   <!-- p>Note: use format DD.DDD or DDMM.MM</p-->
				   <input type="button" value="Show on Map" onclick="showp()" />		        
				<li>Model:</li> 
					<select name="dset" onchange="onch()">
						<option value="massbay" >FVCOM:massbay</option>
						<option value="GOM3" selected="selected">FVCOM:GOM3</option>
						<option value="30yr">FVCOM:30yr</option>
						<option value="ROMS">ROMS</option>
					</select>

				<li>Depth(m):</li>
					<input type='text' name='depth' size='2' value='1' onblur='' maxlength="4">			        

				<li>Track direction:</li>		             
					<input type="radio" name="tway" value="forward" checked="checked" />Forward<br />
					<input type="radio" name="tway" value="backward" />Backward		             

				<li>Start time(EDT):</li>	           
					<!-- p id="" >Note: If time is not specified, it will start now.<br />Enter UTC time In Format: <br />2015-3-25 11:45</p-->
					<p>Time Format: M/D/Y, H:M</p>
					<input type='text' name='stt' value='' onblur=''>
					<input type="button" onclick="settime()" value="Current time" />

				<li>Number of days to track:</li>
					<input type='text' name='tds' size='2' value='1' onblur='' maxlength="4">
			</ol>
			<input type='hidden' name='lons' value='' >
			<input type='hidden' name='lats' value='' >
			<input id="bposition" type='submit' name='submit' value='Submit' >
			<input id="rposition" type='reset' name='' value='Reset' onclick="funreset()">		        
		</form>
	</div>
<script type="text/javascript" >
var reti = new Date();
//var de = reti.toLocaleString()
//.getMonth() return values 0~11 stands for Jan~Dec
var de = (reti.getMonth()+1)+"/"+reti.getDate()+"/"+reti.getFullYear()+", "+reti.getHours()+":"+reti.getMinutes()
document.form1.stt.value = de;	
</script>	
</div>

<div id="footer">
	More detail email james.manning@noaa.gov 
</div>

</body>
</html>
